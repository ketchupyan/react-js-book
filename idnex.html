<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ç‚¹èµç»„ä»¶</title>
</head>
<body>
<div class="wrapper">
    <!-- 
        <button class="like-btn">
            <span class="like-text">ç‚¹èµ</span>
            <span>ğŸ‘</span>
        </button> 
    -->

</div>
<script>
        /* const button = document.querySelector('.like-btn')
         * const buttonText = document.querySelector('.like-text')
         * let isLiked = false
         * button.addEventListener('click', () => {
         *     isLiked = !isLiked
         *     if(isLiked) {
         *         buttonText.innerHTML = 'å–æ¶ˆ'
         *     } else {
         *         buttonText.innerHTML = 'ç‚¹èµ'
         *    }
         * })
         */
        // ç¼ºç‚¹ï¼Ÿ DOMåŒ–  åº•å±‚ 
        // å»DOMåŒ–  è™šæ‹ŸDOMç»“ç‚¹  react  react-dom
        // ç»„ä»¶åŒ–-å¤ç”¨ -> ç±»åŒ– <==> React|Vue.Component
        // .vue  .jsx æ–¹ä¾¿æ€§å¼ºäºä¸€èˆ¬çš„ç±»åŒ–
        // äº‹ä»¶ï¼Ÿ ä¸èƒ½æ˜¯HTML(è¡Œå†…) æœ€å¥½æ˜¯DOM
        const createDOMFromString = (domString) => {
            const div = document.createElement('div')
            div.innerHTML = domString
            return div
        }
        // DOM ç»“ç‚¹çš„éƒ¨åˆ†æ›´æ–°  hot-reload
        // è™šæ‹ŸDOM(åœ¨å†…å­˜ä¸­)æ›´æ–° ä¸€å®šçš„æ›´æ–°åï¼ŒåŒæ­¥åˆ°DOMç»“ç‚¹    
        // ç•Œé¢å°±äº§ç”Ÿäº†çŠ¶æ€çš„æ”¹å˜
    
        // class LikeButton {
        //     constructor() {
        //         this.state = {
        //             isLiked: false
        //         }
        //     }
    
        //     render() {
        //         this.el = createDOMFromString(`
        //             <button id='like-btn'>
        //                 <span class='like-text'>${this.state.isLiked?'å–æ¶ˆ':'ç‚¹èµ'}</span>
        //                 <span>ğŸ‘</span>
        //             </button>
        //         `)
        //         this.el.addEventListener('click', this.changeLikeText.bind(this), false)
        //         return this.el
        //     }
    
        //     setState(state) {
        //         this.state = state
        //         const oldEl = this.el
        //         // new el
        //         this.el = this.render()
        //         if(this.onStateChange)
        //             this.onStateChange(oldEl, this.el)
        //     }
    
        //     changeLikeText() {
        //         this.setState({
        //             isLiked: !this.state.isLiked
        //         })
        //         /* const likeText = this.el.querySelector('.like-text')
        //          * this.state.isLiked = !this.state.isLiked
        //          * likeText.innerHTML = this.state.isLiked?'å–æ¶ˆ':'ç‚¹èµ'
        //          */
    
        //         // çŠ¶æ€æ”¹å˜->ç•Œé¢ä¹Ÿè·Ÿç€å˜ï¼Ÿ
        //         // å†æ‰§è¡Œä¸€æ¬¡render()
        //     }      
        // }
        // const wrapper = document.querySelector('.wrapper')
        // const likeButton1 = new LikeButton()
        // wrapper.appendChild(likeButton1.render())
    
        // // è€çš„ç»“ç‚¹è¿˜åœ¨domä¸Šï¼Œ æ–°çš„ç»“ç‚¹å·²ç»å‡†å¤‡å¥½äº† æ²¡æœ‰æŒ‚è½½ä¸Šå»
        // likeButton1.onStateChange = (oldEl, newEl) => {
        //     wrapper.insertBefore(newEl, oldEl)
        //     wrapper.removeChild(oldEl)
        // }
    
        const mount = (component, wrapper) => {
            wrapper.appendChild(component._renderDOM())
            component.onStateChange = (oldEl , newEl) => {
                wrapper.insertBefore(newEl, oldEl)
                wrapper.removeChild(oldEl)
            }
        }
    
        class Component {
            constructor(props={}) {
                this.props = props
                console.log('çˆ¶ç±»æ„é€ æ–¹æ³•')
            }
            setState (state) {
                const oldEl = this.el
                this.state = state
                this.el = this._renderDOM()
                // åŠ¨æ€è¯­è¨€ è¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€æ·»åŠ æ–¹æ³•æˆ–å±æ€§
                if(this.onStateChange) {
                    this.onStateChange(oldEl, this.el)
                }
            }
            _renderDOM() {
                // å­ç±»ï¼Œä¸€å®šå¾—æä¾›renderæ–¹æ³•
                // renderè§£æ”¾ Hiéœ€è¦æä¾›UI html
                this.el = createDOMFromString(this.render())
                if (this.onClick) {
                    this.el.addEventListener('click', this.onClick.bind(this), false)
                }
                return this.el
            }
        }
    
        class LikeButton extends Component {
            constructor(props) {
                super(props)
                this.state = {
                    isLiked: false
                }
            }
            onClick() {
                this.setState({
                    isLiked: !this.state.isLiked
                })
            }
            render() {
                return `
                    <button id='like-btn' style="background-color:${this.props.bgColor}">
                        <span class='like-text'>${this.state.isLiked?'å–æ¶ˆ':'ç‚¹èµ'}</span>
                        <span>ğŸ‘</span>
                    </button>
                `
            }
        }
    
        mount(new LikeButton({bgColor:'red'}), document.querySelector('.wrapper'))
    </script>
</body>
</html>